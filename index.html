<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Raccolta Punti Clienti</title>
  <link rel="stylesheet" href="styles.css"><!-- oppure stili.css se il file ha quel nome -->
</head>

<body>
  <main class="container">

    <h1>Raccolta Punti â€” Gestione Clienti</h1>

    <!-- ============================ -->
    <!-- LOGIN SECTION -->
    <!-- ============================ -->
    <section id="loginSection" class="card">
      <h2>Accesso riservato</h2>

      <div class="field">
        <label>Email</label>
        <input id="loginEmail" type="email" placeholder="La tua email di accesso">
      </div>

      <div class="field">
        <label>Password</label>
        <input id="loginPassword" type="password" placeholder="Password">
      </div>

      <div class="actions">
        <button id="btnLogin">ðŸ”“ Entra</button>
      </div>

      <div id="loginStatus" class="status"></div>
    </section>

    <!-- ============================ -->
    <!-- MAIN APP SECTION -->
    <!-- ============================ -->
    <section id="appSection" class="hidden">

      <div class="card">
        <div class="actions" style="justify-content: space-between;">
          <div><strong>Utente loggato:</strong> <span id="currentUserEmail"></span></div>
          <button id="btnLogout" class="danger">ðŸ”’ Esci</button>
        </div>
      </div>

      <!-- âœ… CONTATORE TESSERE CLIENTI -->
      <div class="card">
        <strong>Tessere caricate:</strong>
        <span id="clientCount">â€¦</span>
      </div>

      <!-- ============================ -->
      <!-- OPERAZIONI GLOBALI -->
      <!-- ============================ -->
      <section class="card">
        <h3>Operazioni globali</h3>

        <p class="status" style="margin-bottom: 0.5rem;">
          Questi pulsanti agiscono su <strong>tutti</strong> i clienti. Usali con attenzione.
        </p>

        <div class="actions" style="flex-direction: column; align-items: stretch; gap: 0.8rem;">
          <button id="btnExportCsv">ðŸ“¥ Backup clienti (CSV)</button>

          <button id="btnResetAllPoints" class="danger">
            ðŸ§¹ Azzera punti per TUTTI i clienti
          </button>

          <!-- NUOVO PULSANTE: esporta contatti per rubrica (VCF) -->
          <button id="btnExportVcf">
            ðŸ“‡ Esporta contatti in rubrica (VCF)
          </button>
        </div>

        <!-- Spazio per separare dai blocchi successivi -->
        <div style="height: 80px;"></div>
      </section>

      <!-- ============================ -->
      <!-- RICERCA CLIENTE: TELEFONO -->
      <!-- ============================ -->
      <section class="search">

        <label>Numero di telefono (accesso/ricerca)</label>
        <div class="row">
          <input id="phoneInput" placeholder="es. 3478552229 o +39 347...">
          <button id="btnLoad">Apri scheda</button>
          <button id="btnNew">Nuovo cliente</button>
        </div>

        <!-- ============================ -->
        <!-- RICERCA PER NOME/COGNOME -->
        <!-- ============================ -->
        <label style="margin-top:1rem;">Ricerca per nome o cognome</label>
        <div class="row">
          <input id="nameSearchInput" placeholder="es. Maria, Rossi, Maria Rossi">
          <button id="btnSearchName">Cerca</button>
        </div>

      </section>

      <!-- RISULTATI RICERCA -->
      <section id="searchResults" class="card hidden">
        <h3>Risultati ricerca</h3>
        <div id="searchResultsList" class="transactions"></div>
      </section>

      <!-- ============================ -->
      <!-- SCHEDA CLIENTE -->
      <!-- ============================ -->
      <section id="card" class="card hidden">
        <h2>Scheda Cliente</h2>

        <div class="field">
          <label>Numero</label>
          <input id="phone" readonly>
        </div>

        <div class="field">
          <label>Nome</label>
          <input id="firstName">
        </div>

        <div class="field">
          <label>Cognome</label>
          <input id="lastName">
        </div>

        <div class="field">
          <label>Note</label>
          <textarea id="notes" rows="4"></textarea>
        </div>

        <!-- ============================ -->
        <!-- PUNTI -->
        <!-- ============================ -->
        <div class="points">
          <label>Punti attuali</label>
          <div class="points-row">
            <div id="pointsValue" class="points-value">0</div>

            <div class="points-buttons">
              <button class="small" data-delta="1">+1</button>
              <button class="small" data-delta="5">+5</button>
              <button class="small" data-delta="-1">-1</button>
              <button class="small" data-delta="-5">-5</button>
            </div>
          </div>

          <div class="manual">
            <input id="manualDelta" type="number" placeholder="Inserisci numero">
            <button id="btnAddManual">AGGIUNGI</button>
            <button id="btnSubManual">SCALA</button>
          </div>
        </div>

        <h3>Storico transazioni</h3>
        <div id="transactionsList" class="transactions"></div>

        <div class="actions">
          <button id="btnSave">ðŸ’¾ Salva</button>
          <button id="btnWhats">ðŸ’¬ WhatsApp</button>
          <button id="btnDelete" class="danger">ðŸ—‘ Elimina cliente</button>
        </div>

        <div id="status" class="status"></div>
      </section>

      <footer>
        <small>Versione con login â€” protetta da Firebase Authentication.</small>
      </footer>

    </section>

  </main>

  <!-- COLLEGAMENTO AL JAVASCRIPT -->
  <script type="module" src="app.js"></script>
</body>
</html>

